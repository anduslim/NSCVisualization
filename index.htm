<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Live Sensor Readings Plot</title>

		<script type="text/javascript" src="./js/jquery.min.js"></script>
		<script type="text/javascript">
			
			var chart;
			var lastTimeStamp = 0;
			
			function requestData() {
				$.ajax({
					url: 'fetch-from-mysql.php',
					success: function(point) {
						var result = eval(point);
						if (lastTimeStamp == 0) { lastTimeStamp = result[0] }
						if (lastTimeStamp != result[0]) {
							// add the point
							var series = chart.series[0], shift = series.data.length > 200;
							chart.series[0].addPoint(result, true, shift);
						}
						//console.log(result[0]);
						// call it again after one second
						setTimeout(requestData, 1000);	
					},
					cache: false
				});
				//console.log("hello")
			}
			
			$(function() {
				$(document).ready(function() {
					chart = new Highcharts.Chart({
						credits: {
								enabled: false
						},
						chart: {
							renderTo: 'container',
							//defaultSeriesType: 'spline',
							events: {
								load: requestData
								
								/*
								function() {
									// set up the updating of the chart each second
									var series = this.series[0];
									setInterval(function() {
										var x = (new Date()).getTime(),
										y = Math.random();
										series.addPoint([x, y], true, true);
									}, 1000);
								}
								*/
							}
						},
						title: {
							text: 'Random Sensor Data',
							x: -20 //center
						},
						subtitle: {
							text: 'Sense & Sense-abilities',
							x: -20
						},
						xAxis: {
							title: {
								text: 'Time',
							},
							type: 'datetime',
						},
						yAxis: {
							title: {
								text: 'Noise Level',
							},
						},
						series: [{
							name: 'Random data',
							data: []
							/*
							data: (function() {
								// generate an array of random data
								var data = [],
									time = (new Date()).getTime(),
									i;
			
								for (i = -19; i <= 0; i++) {
									data.push({
										x: time + i * 1000,
										y: Math.random()
									});
								}
								
								return data;
							})()
							*/
						}]
					});
				});
			});
		</script>
		
	</head>
	<body>
		<script src="./js/highcharts.js"></script>
		<script src="./js/modules/exporting.js"></script>

		<div id="container" style="width: 100%; height: 800px; margin: 0px auto;"></div>
		
	</body>
</html>
